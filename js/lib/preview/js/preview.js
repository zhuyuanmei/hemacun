define(function(require,exports,module){var win=$(window),doc=$(document),count=1,isIE6=!-[1,]&&!window.XMLHttpRequest,isLock=false;var Preview=function(options){this.settings=$.extend({},Preview.defaults,options);this.init()};Preview.prototype={init:function(){this.create();if(this.settings.lock){this.lock()}if(this.settings.time){this.time()}},create:function(){var templates="";if(this.settings.setHeader){templates='<div class="rDialog-wrap">'+'<div class="rDialog-header">'+this.settings.title+"</div>"+'<div class="rDialog-content">'+this.settings.content+"</div>"+'<div class="rDialog-footer"></div>'+"</div>"}else{templates='<div class="rDialog-wrap">'+'<div class="rDialog-content">'+this.settings.content+"</div>"+'<div class="rDialog-footer"></div>'+"</div>"}this.preview=$("<div>").addClass("rDialog").css({zIndex:this.settings.zIndex+(count++)}).html(templates);this.preview.prependTo("body");if($(".rDialog-header").length&&this.settings.headerBackground){$(".rDialog-header").css("backgroundColor",this.settings.headerBackground)}if($.isFunction(this.settings.ok)&&this.settings.okText!==""){this.ok()}if($.isFunction(this.settings.cancel)&&this.settings.cancelText!==""){this.cancel()}this.size();this.position();this.bindEvent();if(this.settings.background!==""){$(".rDialog").css("top",5);win.on("resize",function(){$(".rDialog").css("top",5)});$(".rDialog-wrap").css({"background":"none","border":"none"})}},ok:function(){var _this=this,footer=this.preview.find(".rDialog-footer")[0];var closeBtn=$('<a href="javascript:;" class="rDialog-ok">'+this.settings.okText+"</a>");closeBtn.prependTo(footer);if(this.settings.okSize){closeBtn.css({"width":"80%","background":"#a4269e"})}closeBtn.on("click",function(){if(_this.settings.okCallBack){_this.settings.ok()}else{_this.close()}})},cancel:function(){var _this=this,footer=this.preview.find(".rDialog-footer")[0];var closeBtn=$('<a href="javascript:;" class="rDialog-cancel">'+this.settings.cancelText+"</a>");closeBtn.prependTo(footer);closeBtn.on("click",function(){_this.close()})},size:function(){var content=this.preview.find(".rDialog-content"),wrap=this.preview.find(".rDialog-wrap");content.css({width:this.settings.width,height:this.settings.height});wrap.css("width",content.width())},position:function(){var _this=this,winWidth=win.width(),winHeight=win.height(),scrollTop=0;this.preview.css({left:(winWidth-_this.preview.width())/2,top:(winHeight-_this.preview.height())/2+scrollTop})},lock:function(){if(isLock){return}this.lock=$("<div>").css({zIndex:this.settings.zIndex}).addClass("rDialog-mask");this.lock.appendTo("body");if(isIE6){this.lock.css({height:$("body").height()});this.lock.html('<iframe style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:-1;border:0 none;filter:alpha(opacity=0)"></iframe>')}isLock=true},unLock:function(){if(this.settings.lock){if(isLock){this.lock.remove();isLock=false}}},close:function(){this.preview.remove();this.unLock()},time:function(){var _this=this;this.closeTimer=setTimeout(function(){_this.close()},this.settings.time)},bindEvent:function(){var _this=this,close=this.preview.find(".rDialog-close");close.on("click",function(){_this.close()});win.on("resize",function(){_this.position()});if(isIE6){win.on("scroll",function(){_this.position()})}}};Preview.defaults={content:"请稍等...",title:"提示",width:"auto",height:"auto",ok:function(){},cancel:function(){},okText:"",okCallBack:false,okSize:false,cancelText:"",time:null,lock:false,isDrag:true,zIndex:9999,background:"",setHeader:true,headerBackground:""};var rPreview=function(options){new Preview(options)};window.rPreview=$.rPreview=$.preview=rPreview});